import{a as K}from"./chunk-E24Q2367.js";import{$a as _,$b as H,Ab as V,Ca as b,Cb as P,Db as I,Eb as N,Na as u,Oa as e,Ob as F,Pa as t,Pb as W,Qa as S,Qb as D,Rb as L,Sb as A,Ta as v,Tb as B,Ua as g,Ub as R,Va as s,Vb as q,Wb as U,X as m,Xb as j,Y as p,Za as O,Zb as z,_a as n,_b as G,a as M,ac as J,cb as x,db as f,eb as C,fb as h,gb as E,hb as y,pa as c,ta as T,za as w,zb as k}from"./chunk-2AP6R54K.js";function Y(d,o){d&1&&(e(0,"div"),n(1,"Loading\u2026"),t())}function Z(d,o){if(d&1&&(e(0,"div",9),n(1),t()),d&2){let r=s();c(),_(r.error)}}function $(d,o){if(d&1){let r=v();e(0,"tr")(1,"td"),n(2),h(3,"currency"),t(),e(4,"td"),n(5),t(),e(6,"td"),n(7),h(8,"date"),t(),e(9,"td"),n(10),t(),e(11,"td",10)(12,"button",4),g("click",function(){let i=m(r).$implicit,l=s();return p(l.openEdit(i))}),n(13,"Edit"),t(),e(14,"button",4),g("click",function(){let i=m(r).$implicit,l=s();return p(l.delete(i.id))}),n(15,"Delete"),t()()()}if(d&2){let r=o.$implicit;c(2),_(E(3,4,r.amount)),c(3),_(r.category),c(2),_(y(8,6,r.date,"MMM d, y")),c(3),_(r.note)}}function ee(d,o){d&1&&(e(0,"tr")(1,"td",11),n(2,"No income entries."),t()())}function te(d,o){if(d&1){let r=v();e(0,"tr")(1,"td"),n(2),h(3,"currency"),t(),e(4,"td"),n(5),t(),e(6,"td"),n(7),h(8,"date"),t(),e(9,"td"),n(10),t(),e(11,"td",10)(12,"button",4),g("click",function(){let i=m(r).$implicit,l=s();return p(l.openEdit(i))}),n(13,"Edit"),t(),e(14,"button",4),g("click",function(){let i=m(r).$implicit,l=s();return p(l.delete(i.id))}),n(15,"Delete"),t()()()}if(d&2){let r=o.$implicit;c(2),_(E(3,4,r.amount)),c(3),_(r.category),c(2),_(y(8,6,r.date,"MMM d, y")),c(3),_(r.note)}}function ne(d,o){d&1&&(e(0,"tr")(1,"td",11),n(2,"No expense entries."),t()())}function ie(d,o){if(d&1){let r=v();e(0,"div",12),g("click",function(){m(r);let i=s();return p(i.closeEdit())}),e(1,"div",13),g("click",function(i){return m(r),p(i.stopPropagation())}),e(2,"h3"),n(3,"Edit Transaction"),t(),e(4,"form",14,0),g("ngSubmit",function(){m(r);let i=s();return p(i.saveEdit())}),e(6,"div",15)(7,"div")(8,"label"),n(9,"Type"),t(),e(10,"select",16),C("ngModelChange",function(i){m(r);let l=s();return f(l.editing.type,i)||(l.editing.type=i),p(i)}),e(11,"option",17),n(12,"Income"),t(),e(13,"option",18),n(14,"Expense"),t()()(),e(15,"div")(16,"label"),n(17,"Amount"),t(),e(18,"input",19),C("ngModelChange",function(i){m(r);let l=s();return f(l.editing.amount,i)||(l.editing.amount=i),p(i)}),t()(),e(19,"div")(20,"label"),n(21,"Category"),t(),e(22,"select",20),C("ngModelChange",function(i){m(r);let l=s();return f(l.editing.category,i)||(l.editing.category=i),p(i)}),e(23,"option",21),n(24,"Food"),t(),e(25,"option",22),n(26,"Rent"),t(),e(27,"option",23),n(28,"Transport"),t(),e(29,"option",24),n(30,"Entertainment"),t(),e(31,"option",25),n(32,"Other"),t()()(),e(33,"div")(34,"label"),n(35,"Date"),t(),e(36,"input",26),C("ngModelChange",function(i){m(r);let l=s();return f(l.editing.date,i)||(l.editing.date=i),p(i)}),t()(),e(37,"div",27)(38,"label"),n(39,"Note"),t(),e(40,"input",28),C("ngModelChange",function(i){m(r);let l=s();return f(l.editing.note,i)||(l.editing.note=i),p(i)}),t()()(),e(41,"div",29)(42,"button",30),g("click",function(){m(r);let i=s();return p(i.closeEdit())}),n(43,"Cancel"),t(),e(44,"button",31),n(45,"Save"),t()()()()()}if(d&2){let r=O(5),a=s();c(10),x("ngModel",a.editing.type),c(8),x("ngModel",a.editing.amount),c(4),x("ngModel",a.editing.category),c(14),x("ngModel",a.editing.date),c(4),x("ngModel",a.editing.note),c(4),u("disabled",!r.form.valid)}}var Q=class d{constructor(o){this.api=o}transactions=[];loading=!0;error="";editOpen=!1;editing=null;editingId="";ngOnInit(){this.fetch()}fetch(){this.loading=!0,this.api.getTransactions().subscribe({next:o=>{this.transactions=o||[],this.loading=!1},error:()=>{this.loading=!1,this.error="Failed to load transactions."}})}get incomes(){return this.transactions.filter(o=>o.type==="income")}get expenses(){return this.transactions.filter(o=>o.type==="expense")}openEdit(o){this.editingId=o.id||"",this.editing=M({},o),this.editOpen=!0}closeEdit(){this.editOpen=!1,this.editing=null,this.editingId=""}saveEdit(){if(!this.editing||!this.editingId)return;let o=this.editing;if(!o.type||!o.category||!o.date||!o.note||!isFinite(Number(o.amount))||Number(o.amount)<=0){alert("Please fill all fields with valid values.");return}let r={type:o.type,category:o.category,amount:Number(o.amount),date:o.date,note:o.note.trim()};this.api.updateTransaction(this.editingId,r).subscribe({next:a=>{let i=this.transactions.findIndex(l=>l.id===this.editingId);i>=0&&(this.transactions[i]=a),this.closeEdit()},error:()=>alert("Failed to update transaction.")})}delete(o){o&&confirm("Delete this transaction?")&&this.api.deleteTransaction(o).subscribe({next:()=>this.transactions=this.transactions.filter(r=>r.id!==o),error:()=>alert("Failed to delete.")})}exportCsv(o){let r=o==="all"?void 0:o;this.api.exportTransactionsCsv(r).subscribe({next:a=>{let i=URL.createObjectURL(a),l=document.createElement("a"),X=`transactions_${o||"all"}.csv`;l.href=i,l.download=X,document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(i)},error:()=>alert("CSV export failed.")})}static \u0275fac=function(r){return new(r||d)(T(K))};static \u0275cmp=w({type:d,selectors:[["app-transactions"]],decls:46,vars:7,consts:[["editForm","ngForm"],[4,"ngIf"],["class","error",4,"ngIf"],[1,"btn-row"],[3,"click"],[1,"section-title"],[1,"table"],[4,"ngFor","ngForOf"],["class","modal-backdrop",3,"click",4,"ngIf"],[1,"error"],[1,"table-actions"],["colspan","5"],[1,"modal-backdrop",3,"click"],[1,"modal",3,"click"],[3,"ngSubmit"],[1,"grid"],["name","type","required","",3,"ngModelChange","ngModel"],["value","income"],["value","expense"],["type","number","min","0.01","step","0.01","name","amount","required","",3,"ngModelChange","ngModel"],["name","category","required","",3,"ngModelChange","ngModel"],["value","Food"],["value","Rent"],["value","Transport"],["value","Entertainment"],["value","Other"],["type","date","name","date","required","",3,"ngModelChange","ngModel"],[1,"span-2"],["type","text","maxlength","80","name","note","required","",3,"ngModelChange","ngModel"],[1,"actions"],["type","button",3,"click"],["type","submit",3,"disabled"]],template:function(r,a){r&1&&(e(0,"h2"),n(1,"Transactions"),t(),b(2,Y,2,0,"div",1)(3,Z,2,1,"div",2),e(4,"div",3)(5,"button",4),g("click",function(){return a.exportCsv("all")}),n(6,"Export CSV (All)"),t(),e(7,"button",4),g("click",function(){return a.exportCsv("income")}),n(8,"Export CSV (Income)"),t(),e(9,"button",4),g("click",function(){return a.exportCsv("expense")}),n(10,"Export CSV (Expense)"),t()(),e(11,"div",5),n(12,"Income"),t(),e(13,"table",6)(14,"thead")(15,"tr")(16,"th"),n(17,"Amount"),t(),e(18,"th"),n(19,"Category"),t(),e(20,"th"),n(21,"Date"),t(),e(22,"th"),n(23,"Note"),t(),S(24,"th"),t()(),e(25,"tbody"),b(26,$,16,9,"tr",7)(27,ee,3,0,"tr",1),t()(),e(28,"div",5),n(29,"Expenses"),t(),e(30,"table",6)(31,"thead")(32,"tr")(33,"th"),n(34,"Amount"),t(),e(35,"th"),n(36,"Category"),t(),e(37,"th"),n(38,"Date"),t(),e(39,"th"),n(40,"Note"),t(),S(41,"th"),t()(),e(42,"tbody"),b(43,te,16,9,"tr",7)(44,ne,3,0,"tr",1),t()(),b(45,ie,46,6,"div",8)),r&2&&(c(2),u("ngIf",a.loading),c(),u("ngIf",a.error),c(23),u("ngForOf",a.incomes),c(),u("ngIf",a.incomes.length===0),c(16),u("ngForOf",a.expenses),c(),u("ngIf",a.expenses.length===0),c(),u("ngIf",a.editOpen))},dependencies:[N,k,V,I,P,J,B,U,j,F,R,q,W,D,G,H,z,A,L],styles:[".filters[_ngcontent-%COMP%], .summary[_ngcontent-%COMP%]{margin-bottom:1rem;display:flex;gap:1rem;align-items:center;flex-wrap:wrap}.summary[_ngcontent-%COMP%]{background:#f8f9fa;padding:.75rem;border:1px solid #ddd;border-radius:6px;font-size:.95rem}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:1.5rem}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #ccc;text-align:left}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f2f2f2}.section-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;margin:1rem 0 .5rem}button[_ngcontent-%COMP%]{padding:.25rem .6rem;background:#dc143c;color:#fff;border:none;border-radius:4px;cursor:pointer;transition:background .2s}button[_ngcontent-%COMP%]:hover{background:#8b0000}button.active[_ngcontent-%COMP%]{background:#333;font-weight:700}.export-btn[_ngcontent-%COMP%]{background:#007bff}.export-btn[_ngcontent-%COMP%]:hover{background:#0056b3}.delete-income[_ngcontent-%COMP%]{background:#17a2b8}.delete-income[_ngcontent-%COMP%]:hover{background:#117a8b}.delete-expense[_ngcontent-%COMP%]{background:#dc143c}.delete-expense[_ngcontent-%COMP%]:hover{background:#8b0000}.pagination[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#eee;color:#333;border:1px solid #ccc}.pagination[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#dc143c;color:#fff}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(.active){background:#ddd}select[_ngcontent-%COMP%]{padding:.25rem;border-radius:4px;border:1px solid #ccc}"]})};export{Q as TransactionsComponent};
